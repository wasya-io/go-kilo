# CHANGELOG

## [0.0.23] - 2024-02-19
### Changed
- テスト用メソッドの再配置
  - テストでのみ使用されるメソッドを`editor.go`から`editor_test_helpers.go`に移動
  - 以下のメソッドを移動
    - `GetCharAtCursor()`
    - `GetContent()`
    - `GetLineCount()`
    - `SetKeyReader()`
    - `IsDirty()`
  - エディタコアの責務をより明確に分離

## [0.0.22] - 2024-02-19
### Added
- タブキーのカスタマイズ機能を実装
  - タブキー入力を半角スペースに変換
  - 変換する半角スペースの数を.envで設定可能
  - デフォルトのタブ幅を2文字に設定
  - 設定管理用のConfig構造体を追加
  - godotenvパッケージによる環境変数管理
  - タブ変換機能のテストケースを追加

## [0.0.21] - 2024-02-19
### Added
- Bufferにカーソル位置の文字を取得する機能を追加
  - GetCharAtCursorメソッドの実装
  - カーソル位置の無効な場合のエラーハンドリング
- Row構造体にGetRuneAtメソッドを追加
  - 指定位置の文字（rune）を取得する機能
  - 範囲外アクセスの適切な処理

## [0.0.20] - 2024-02-18
### Changed
- テスト実行環境の設定を調整 (.vscode/settings.json)
  - テストタイムアウトを30秒に延長
  - カバレッジ表示のハイライトカラーを設定
  - テスト実行時のフラグ（-v -run ^Test）を追加

## [0.0.19] - 2024-02-18
### Added
- バッファー管理とパフォーマンスの大幅な改善
  - カーソル位置の計算を最適化
  - 文字幅と表示位置のキャッシュ機構の強化
  - 二分探索による文字位置計算の高速化
  - ルーンベースの文字操作の実装

### Changed
- Row構造体の機能拡張
  - 文字幅と位置情報のキャッシュ機構の改善
  - 画面位置とバッファー位置の変換を効率化
  - パフォーマンスを考慮したメモリ管理の最適化

## [0.0.18] - 2024-02-18
### Added
- Buffer管理機能の強化
  - Row構造体のキャッシュ機制の実装
  - 文字幅と表示位置の高速な計算
  - パフォーマンスを考慮したバッファ操作の最適化
- 文字操作機能の改善
  - より正確な文字位置の計算
  - 改行処理の信頼性向上
  - マルチバイト文字のサポート強化

### Changed
- バッファ管理のアーキテクチャを改善
  - Row構造体の機能拡張
  - 文字幅計算の効率化
  - カーソル位置管理の最適化

## [0.0.17] - 2024-02-18
### Fixed
- ESCキーの処理を改善
  - ESCキー単体の入力を正しく処理
  - エスケープシーケンスの読み取り処理を柔軟に
  - タイムアウト時の適切なフォールバック処理を追加
  - ESCキー関連の定数を追加

## [0.0.16] - 2024-02-18
### Changed
- UI, Buffer, Storageの責務をさらに分離
  - スクロール処理とUI更新ロジックをui.goに移動
  - カーソル位置の文字取得ロジックをbuffer.goに集約
  - ファイル操作関連の機能をstorage.goに移動
  - テストの修正と改善
  - コンパイルエラーの修正

## [0.0.15] - 2024-02-17
### Changed
- アーキテクチャの大規模な改善
  - コードベースをクリーンアーキテクチャの原則に基づいて再構成
  - 単一責任の原則に基づいて各コンポーネントを分離
  - エディタの責務を明確に分割し、メンテナンス性と拡張性を向上

### Added
- テキストバッファ管理の分離と改善 (`buffer.go`)
  - Row構造体とその操作メソッドを専用ファイルに分離
  - 文字幅計算と位置変換ロジックの集約
  - バッファ操作の再利用性向上

## [0.0.14] - 2024-02-17
### Added
- UI関連処理の分離と改善 (`ui.go`)
  - `UI` 構造体の導入
  - 画面描画ロジックの集約
  - ANSI制御シーケンスの一元管理
  - ステータスバーとメッセージ表示の分離

### Changed
- エディタのコア処理をUI処理から分離
  - `Editor` 構造体からUI関連の責務を削除
  - 画面描画処理を `UI` 構造体に委譲
  - 関心の分離による保守性の向上

## [0.0.13] - 2024-02-17

### Fixed
- 日本語入力モードでの文字入力に関する問題を修正
  - IMEを通じた複数文字の一括入力に対応
  - StandardKeyReaderに入力バッファを追加
  - マルチバイト文字の連続入力処理を改善

### Changed
- テストヘルパーメソッドを `editor.go` から `editor_test_helpers.go` に分離
- `CursorMovement` 型の定義を改善し、テストでの使用をより直感的に

### Added
- `editor_test_helpers.go` ファイルを新規作成し、以下のテストヘルパーメソッドを移動
  - `GetRows`
  - `TestInput`
  - `TestSetCursor`
  - `TestGetCursor`
  - `TestMoveCursor`
  - `TestProcessInput`
  - `TestDelete`
  - `TestMoveCursorByByte`
- ストレージ層の抽象化と実装
  - `Storage` インターフェースの追加
  - `FileStorage` の実装（実際のファイルシステムを使用）
  - `MockStorage` の実装（テスト用）

### Changed
- エディタのファイル操作の改善
  - ファイルの読み書き処理をストレージ層に移動
  - エディタにストレージインスタンスを追加
  - ファイル操作の信頼性とテスト容易性を向上

### Added
- カーソル位置の文字を取得する機能を追加
  - `GetCharAtCursor()` メソッドの実装
  - カーソル位置が無効な場合の適切なエラーハンドリング

- コンテンツ取得機能の追加
  - `GetContent()` メソッドによる指定行の内容取得
  - `GetLineCount()` メソッドによる総行数の取得
  - テスト用のコンテンツ参照機能の強化

### Changed
- テスト用ヘルパーメソッドの改善
  - キー入力シミュレーション機能の強化
  - カーソル操作のテストを容易にする機能の追加

## [0.0.12] - 2024-02-16

### Fixed
- マルチバイト文字入力時の文字化けを修正
  - UTF-8文字の入力バッファサイズを4バイトに拡大
  - マルチバイト文字のデコード処理を改善
  - 入力テストの自動化による品質保証

### Added
- マルチバイト文字入力のテストケース
  - ひらがな、漢字、カタカナの入力テスト
  - 混合文字（英数字と日本語）の入力テスト
  - 絵文字の入力テスト

## [0.0.11] - 2024-02-16

### Added
- Row構造体の導入
  - 文字幅情報のキャッシュ機能
  - 表示位置の累積値を事前計算
  - 最適化された文字列操作メソッド

### Changed
- マルチバイト文字処理の大幅な最適化
  - カーソル移動時の文字幅計算を効率化
  - 画面描画処理のパフォーマンス改善
  - メモリ使用量の最適化

## [0.0.10] - 2024-02-16

### Added
- スクロール機能の実装
  - 垂直・水平方向のスクロール処理
  - 画面外のテキスト表示に対応
  - カーソル位置に応じた自動スクロール

### Changed
- エディタのパフォーマンスを改善
  - 画面更新処理の最適化
  - スクロール位置を考慮した部分的な描画
  - カーソル移動の制限を適切に調整
  - 行末でのカーソル位置の自動調整

## [0.0.9] - 2024-02-14

### Added
- マルチバイト文字（日本語等）のサポート
  - 全角文字の表示幅計算機能
  - UTF-8文字の適切な処理
  - カーソル位置の文字幅対応
  - 行末での文字幅を考慮した折り返し

### Changed
- テキスト処理をバイト単位からルーン（Unicode文字）単位に変更
- golang.org/x/text パッケージを使用した文字幅の正確な計算

## [0.0.8] - 2024-02-14

### Added
- ファイル操作機能の実装
  - ファイルの読み込み機能
  - ファイルの保存機能（Ctrl-S）
  - コマンドライン引数によるファイル指定機能
  - 未保存の変更がある場合の警告機能

- ステータスバーの実装
  - ファイル名の表示
  - 未保存の変更を示すインジケータ（[+]）
  - カーソル位置情報の表示
  - ステータスメッセージの表示（5秒間）

### Changed
- 画面レイアウトの改善
  - テキストエリアとステータスバーの分離
  - メッセージ行の追加

## [0.0.7] - 2024-02-14

### Changed
- コードベースの構造を改善
  - editorパッケージの作成と機能の分離
  - Editor構造体とその関連機能を editor/editor.go に移動
  - 端末制御機能を editor/terminal.go に移動
  - main.goをシンプルなエントリーポイントとして再構成
  - モジュールパスの更新とパッケージ依存関係の整理

## [0.0.6] - 2024-02-14

### Added
- テキスト編集機能の実装
  - 通常文字の入力機能
  - バックスペースによる文字削除
  - エンターキーによる改行処理
  - 行の分割と結合機能
  - 制御文字の判定と処理

## [0.0.5] - 2024-02-14

### Added
- テキストデータ管理機能の実装
  - テキスト行を保持するデータ構造の追加
  - テスト用のダミーテキスト表示機能
  - 画面サイズに応じたテキストのクリッピング処理

- カーソル制御機能の実装
  - カーソル位置（cx, cy）の管理
  - カーソルの表示/非表示制御
  - 矢印キーによるカーソル移動
  - 画面境界とテキスト範囲を考慮したカーソル移動の制限

## [0.0.4] - 2024-02-14

### Fixed
- 終了時に端末状態が正しく復元されない問題を修正
  - 終了処理を一元化（cleanup関数の導入）
  - チャネルベースの終了制御機構の実装
  - シグナルハンドリングとキー入力による終了処理の統一
  - deferを使用した確実な終了処理の実装

## [0.0.3] - 2024-02-14

### Fixed
- Ctrl+Cによる強制終了時に端末の状態が復元されない問題を修正
  - シグナルハンドリング（SIGINT, SIGTERM）の追加
  - 強制終了時の端末状態復元処理の実装

## [0.0.2] - 2024-02-14

### Added
- エディタのウィンドウ管理機能
  - 端末のサイズ自動取得
  - 画面サイズに応じた表示調整
- 改善された画面表示機能
  - strings.Builderを使用したバッファリング処理によるちらつき防止
  - ウェルカムメッセージの中央表示
  - vim風の`~`による空行表示

### Changed
- refreshScreen関数を改善
  - 画面クリアと再描画のロジックを最適化
  - 行末クリア機能の追加

## [0.0.1] - 2024-02-14

### Added
- プロジェクトの基本構成を作成
  - `main.go`: エディタのメインロジック
  - `terminal.go`: 端末制御機能
  - `README.md`: プロジェクト説明

### 実装された機能
- Raw Mode での端末制御
  - エコーの無効化
  - カノニカルモードの無効化
  - シグナル処理の無効化（Ctrl+C, Ctrl+Zなど）
  - その他の特殊入力処理の無効化
  - プログラム終了時の端末設定復元機能

- 基本的なエディタ制御
  - 画面クリア機能
  - Ctrl+C または Ctrl+Q による終了コマンド
  - 基本的なエラーハンドリング

### 技術的な詳細
- unix.Termiosを使用した低レベルな端末制御の実装
- 端末の状態管理のための構造体設計
- エラー発生時の適切な終了処理の実装

### 次のステップ
- エディタウィンドウのサイズ管理
- 画面表示の改善（ちらつき防止）
- テキスト表示機能の実装